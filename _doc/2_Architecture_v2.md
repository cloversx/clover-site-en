* * *

Clover Publishing Architecture
==============================

設計書 v2（更新版）
-----------

本書は、Cloverの正典（canonical）サイトを中心とした長期保存・多言語発信・拡散導線の全体設計を定義する。

* * *

1.  目的（Purpose）  
    =================

本設計の目的は以下である：

1.  思想・記録（および創作物を含む書き物）を長期保存可能な形で残すこと
2.  正典（canonical）を明確に定義し、SEOの分散を防ぐこと
3.  多言語（英語・日本語）での発信を安定的に管理すること
4.  外部プラットフォームでの議論や拡散を可能にすること
5.  将来的な構造変更にも耐えられる設計とすること（表示名や見せ方の変更に強い）

* * *

2.  正典（Canonical）の定義  
==========================

2.1 現在の正典
---------

正典は以下とする：

*   英語版：GitHub Pages（clover-site-en）
*   日本語版：GitHub Pages（clover-site-ja）

Hub（clover-s.org）はナビゲーション用途であり、正典ではない。

* * *

2.2 将来の正典移転（概念のみ定義）
-------------------

将来的に正典ホストを変更する場合、以下が必要となる：

*   canonical の更新
*   hreflang の更新
*   必要に応じて 301 リダイレクト設定
*   ミラー記事冒頭の正典リンク修正

※具体手順は移転時に定義する。

* * *

3.  サイト役割定義  
=================

3.1 Hub（clover-s.org）
---------------------

*   プロフィール
*   リンク集
*   名刺ページ
*   正典ではない

* * *

3.2 GitHub Pages（EN / JA）
-------------------------

役割：

*   正典
*   全コンテンツの現行版管理
*   アーカイブ管理（vN固定保存）
*   バージョン管理（思想段階）
*   長期保存

補足：

*   EN/JA は **リポジトリで分離**して管理する（構造の単純化・事故防止）。
*   ただし、対応する内容が存在する場合は相互に関連付けできる（hreflang/alt_url）。

* * *

3.3 Substack
------------

*   厳選ミラー
*   読者登録
*   メール配信
*   思想の雑誌的運用
*   正典ではない

* * *

3.4 Medium（英語のみ）
----------------

*   英語版の全現行ミラー（または選別ミラー）
*   拡散・導線
*   正典ではない

* * *

3.5 note（日本語のみ）
---------------

*   日本語版の全現行ミラー（または選別ミラー）
*   日本語圏拡散
*   正典ではない

* * *

3.6 Zenn / Qiita
----------------

*   技術寄り記事のみ
*   要約＋正典リンク
*   フル本文は掲載しない

* * *

3.7 LessWrong / Hacker News
---------------------------

*   原則リンクのみ
*   正典またはSubstackへ誘導

* * *

4.  URL構造設計  
==============

本設計は、**表示名（例：Library / Works / Archive 等）とURL構造を完全に分離**する。  
表示名は将来変更可能であり、URLやSEO資産を変更しない。

4.1 現行版（Canonical）
------------------

```
/0/<dir-name>/
```

*   `<dir-name>` は URL を構成するディレクトリ名（安定識別子として運用）。
*   `/0/` は意味に依存しない中立な構造識別子として採用する。

* * *

4.2 アーカイブ（固定スナップショット）
---------------------

```
/0/<dir-name>/v1/
/0/<dir-name>/v2/
```

*   アーカイブは固定し、更新しない。

* * *

4.3 Revisited版（思想的再構成・別物化）
--------------------------

思想的再構成・大改稿等で「別物」と判断した場合：

*   新しい `<dir-name>` で現行版として公開（Version 1から開始）
*   旧コンテンツは保持（過去の思想状態として保存）

* * *

5.  識別子ポリシー（dir-name / content_id）  
=========================================

本設計では「URL用の安定識別子」と「論理識別子」を分離する。

5.1 dir-name（URL用）
------------------

*   小文字推奨
*   ハイフン区切り推奨
*   日付を含めない推奨
*   公開後は原則変更しない
*   サイト内で一意

※dir-nameは「表示名」ではない。意味やカテゴリ変更の影響を受けないことを優先する。

* * *

5.2 content_id（論理識別子）
----------------------

*   front matter の `content_id` は **URL生成に使わない**論理識別子。
*   通常は運用の混乱を避けるため、`content_id` を `<dir-name>` と一致させる（推奨）。
*   アーカイブ化（`/vN/`）しても `content_id` は変更しない（全バージョン共通のID）。

* * *

6.  多言語ポリシー  
=================
7.  英語版と日本語版は必ずしも1対1で存在しない
8.  対応コンテンツがある場合のみ hreflang を設定する
9.  alt_url は任意（対応先がある場合のみ設定）
10.  片言語のみのコンテンツも許容する
11.  アーカイブは言語間で揃わなくてもよい

* * *

7.  メタデータ標準（Front matter）  
================================

### 7.1 必須（推奨として事実上必須）

*   layout（例：`content`）
*   title
*   content_id
*   is_archive（boolean）

※lang / canonical_url などはテンプレの安全設計によりフォールバック可能だが、運用上は推奨。

### 7.2 推奨（SEO・構造）

*   lang（"en" / "ja"）
    *   EN/JAは repo で分離されているため、hreflangのselfは `site.lang` を信頼し事故を防ぐ。
    *   それでも page.lang はデータ整合（検索/フィルタ/将来拡張）に有用なため推奨。
*   canonical_url（空なら自動生成可）
    *   例外（移転・統合・特殊なSEO処理等）の場合のみ手入力する。
*   alt_url（他言語の現行版URL。現行版のみ意味を持つ）
*   first_published（date）
*   last_updated（date）
*   version（number：思想段階）
*   summary（description/OG/RSSに使用）

### 7.3 任意（表示・運用）

*   tags（array）
*   featured（boolean）
*   featured_rank（number）
*   og_image（string）
*   redirect_from（array：将来のURL変更時）

### 7.4 アーカイブ時の運用ポリシー（重要）

*   `alt_url` は基本的に変更しない（アーカイブではロジック側で出力しない前提）。
    *   明快さ優先なら「アーカイブは alt_url を空」に統一してもよい（どちらでも整合は取れる）。
*   `summary` も基本的に変更しない。
    *   運用上の理由で区別したい場合は `"Archived snapshot of Version N."` 等に変更してもよい。
*   `canonical_url` は通常空でよい（自動生成で `/vN/` を含む canonical になる）。
    *   例外時のみ手入力。

* * *

8.  更新モデル  
=============

8.1 軽微修正（versionは繰り上げない）
------------------------

*   同一URLで上書き更新
*   version は変更しない
*   last_updated のみ更新
*   Changelog（本文内）に記録

* * *

8.2 重大更新（versionを繰り上げる）
-----------------------

*   現行版を `/vN/` にコピーして凍結保存（アーカイブ）
*   現行版を更新して version を N+1 にする
*   Changelog（本文内）に Version 行を追加し、以後 minor updates をぶら下げる

* * *

8.3 アーカイブ（固定保存）
---------------

*   v1/v2…形式で固定保存
*   内容を変更しない

* * *

9.  ミラー運用ポリシー  
=====================

フル本文掲載は最大：

*   正典（GitHub Pages）
*   Medium（EN）
*   note（JA）
*   Substack（厳選）

議論サイト（LessWrong / Hacker News 等）は原則リンクのみ。

* * *

10.  SEOポリシー  
===============
11.  各ページに canonical を設定（通常は自動生成、例外時のみ手入力）
12.  hreflang は対応コンテンツがある場合のみ（現行版のみ出力）
13.  同一サイト内に複数バージョンを置かない（現行は1つ、過去は別URLで凍結）
14.  アーカイブは別URLで管理し固定保存
15.  URLは安定運用（表示名変更に影響されない）

* * *

11.  公開前チェックリスト  
========================
*   dir-name確認（小文字・ハイフン・一意）
*   content_id確認（推奨：dir-nameと一致、全バージョンで不変）
*   version確認
*   first_published確認
*   last_updated確認
*   重大更新時はアーカイブ作成済み（/vN/）
*   canonical確認（現行/アーカイブとも self canonical）
*   hreflang確認（現行のみ）
*   ミラー冒頭リンク記載確認（必要な場合）

* * *

12.  設計思想の原則  
==================
*   読まれなくても残る構造を優先する
*   拡散は導線として扱う
*   正典を中心に全てを設計する
*   将来の移転可能性を排除しない
*   表示名と構造識別子（URL）を分離し、変更耐性を最大化する

* * *

現時点の評価
======

この設計は：

*   技術的に整合している
*   SEO的に破綻がない
*   多言語に耐える
*   長期保存に強い
*   思想と制作の進化に対応可能
*   表示名変更や構造変更への耐性が高い

実務レベルで十分安定。

* * *
