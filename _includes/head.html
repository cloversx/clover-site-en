<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="alternate" type="application/rss+xml" title="{{ site.title | escape }} RSS" href="{{ "/feed.xml" | absolute_url }}">

{%- assign site_title = site.title | default: "Site" -%}

{%- capture page_title -%}
{%- if page.title and page.title != "" and page.title != site_title -%}
{{ page.title }} - {{ site_title }}
{%- else -%}
{{ site_title }}
{%- endif -%}
{%- endcapture -%}

<title>{{ page_title | strip | escape }}</title>

{%- comment -%}
canonical_url:
- page.canonical_url があればそれを使う
- 空/未定義なら page.url | absolute_url で自動生成（GitHub Pagesでも堅い）
{%- endcomment -%}
{%- assign canonical = page.canonical_url -%}
{%- if canonical == nil or canonical == "" -%}
  {%- assign canonical = page.url | absolute_url -%}
{%- endif -%}
<link rel="canonical" href="{{ canonical | escape }}">

{%- comment -%}
description / OG:
優先順位: page.summary > page.description > site.description
（summary と description 両方あれば summary 優先）
{%- endcomment -%}
{%- assign desc = "" -%}
{%- if page.summary and page.summary != "" -%}
  {%- assign desc = page.summary -%}
{%- elsif page.description and page.description != "" -%}
  {%- assign desc = page.description -%}
{%- elsif site.description and site.description != "" -%}
  {%- assign desc = site.description -%}
{%- endif -%}

{%- if desc and desc != "" -%}
<meta name="description" content="{{ desc | strip | escape }}">
<meta property="og:description" content="{{ desc | strip | escape }}">
{%- endif -%}

<meta property="og:title" content="{{ page_title | strip | escape }}">
<meta property="og:url" content="{{ canonical | escape }}">

{%- comment -%}
og:type:
- content は archive 含め article に統一
- それ以外は website
{%- endcomment -%}
{%- if page.layout == "content" -%}
  <meta property="og:type" content="article">
{%- else -%}
  <meta property="og:type" content="website">
{%- endif -%}

{%- if page.layout == "content" -%}
  {%- if page.first_published and page.first_published != "" -%}
    <meta property="article:published_time" content="{{ page.first_published | date_to_xmlschema }}">
  {%- endif -%}
  {%- if page.last_updated and page.last_updated != "" -%}
    <meta property="article:modified_time" content="{{ page.last_updated | date_to_xmlschema }}">
  {%- endif -%}
{%- endif -%}

{%- comment -%}
OG image:
- page.og_image があればそれ（相対/絶対どちらでもOK）
- なければデフォルト
- absolute_url で正規化して出す（SNSで確実に拾わせる）
{%- endcomment -%}
{%- assign og_img = page.og_image | default: "/assets/img/og-default.png" -%}
<meta property="og:image" content="{{ og_img | absolute_url }}">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ page_title | strip | escape }}">
{%- if desc and desc != "" -%}
<meta name="twitter:description" content="{{ desc | strip | escape }}">
{%- endif -%}
<meta name="twitter:image" content="{{ og_img | absolute_url }}">

<link rel="icon" type="image/png" sizes="32x32" href="{{ "/assets/img/favicon-32.png" | relative_url }}">
<link rel="icon" type="image/png" sizes="192x192" href="{{ "/assets/img/favicon-192.png" | relative_url }}">
<link rel="apple-touch-icon" sizes="180x180" href="{{ "/assets/img/apple-touch-icon.png" | relative_url }}">

{%- comment -%}
hreflang:
- 現行版だけ（is_archive != true）
- 自言語は site.lang 固定（repo分離運用）
- alt_url は相対/絶対どちらでもOK → absolute_url で正規化
- x-default は英語に寄せる
{%- endcomment -%}
{%- if page.is_archive != true -%}
  <link rel="alternate" hreflang="{{ site.lang }}" href="{{ canonical | escape }}">

  {%- assign alt = page.alt_url -%}
  {%- if alt and alt != "" -%}
    {%- assign alt_lang = "en" -%}
    {%- if site.lang == "en" -%}{%- assign alt_lang = "ja" -%}{%- endif -%}
    <link rel="alternate" hreflang="{{ alt_lang }}" href="{{ alt | absolute_url }}">
  {%- endif -%}

  {%- if site.x_default_lang == "en" -%}
    {%- if site.lang == "en" -%}
      <link rel="alternate" hreflang="x-default" href="{{ canonical | escape }}">
    {%- else -%}
      {%- if alt and alt != "" -%}
        <link rel="alternate" hreflang="x-default" href="{{ alt | absolute_url }}">
      {%- else -%}
        <link rel="alternate" hreflang="x-default" href="{{ canonical | escape }}">
      {%- endif -%}
    {%- endif -%}
  {%- endif -%}
{%- endif -%}

<link rel="stylesheet" href="{{ "/assets/css/main.css" | relative_url }}">
